#!/bin/bash

# Script to run miner on GPUs 0-1 with miner-bridge
# Each GPU gets a different nonce offset to avoid overlap

echo "üåä Neptune CUDA Miner - Starting on GPUs 0-1"
echo "üë§ Worker ID: 49"
echo "üéÆ GPU Model: RTX 4090"
echo "‚öôÔ∏è  Miner Binary: miner_21g"
echo "üîó Wallet Address: nolgam1gg95kxhexzl607kvqf9qfltuhh67r45jw840pu3mc9ntprgpq7v4e5k76l26pg6vhwdkpkak52rvvus4xez4gt0dd96wr52y8cgcntyanadxe9uj0p0vmg47v47xfe9c6ryu37suc3wzlwhye5kzy7nk9x3ppx50038k750z75hvhak8zj9p73p9tq4autdzqr3dxmq4udqwvjcn4af0aecfxclrwf8wk89z777aknhjhfk50g4g0jjrx4u44drek3c2qa2mmxx6js4uses2ldfaztrttu42p02wrluuxvt4ls9k44uxqzhxadetdrzaahy2v5ntcjwqjfujmn6vc6mcxdtd0eqppwjqm4h4m72frrf6z79gmf8g6h47zlc7k44se09v6dxqcg6hygndlyzyldn77q0ysam7wz6summmkdpjftx0tmvptn9kvst5j0rhzv33ayu7q25zgf82xh743r94jr7dc0qgqrrzg0hr23mtm2hqp80uaqzwnm4gsf4vfsylzuc79d7u2rmzew27e5z9mwl3ej95hj79gm264p5zmcwnk4vw370crxrpacfaaxf9mukhpx0w3lyyswh483zhn90kycc9cky4zafdtxev5aprjf64md6uus7spxxfm20qpvmzjp8g376yrn0rm9l8u337fj7xx3wuwqexfqyttrzydnqsfex3yjurh5wy5jc0dsqen58s6lr704tgujyjk0afmeqt2sst3s0rkwrnqgrv2q5k88gl40dznuj6a02ynlpwed8e4fcdr2dshv2fa7kv4a8laqvg0tqlvunhqkwst7sgmujxtaw73ejjczwl9ucs767rh4xcaujqw2a798my8ngfk6m6v0dsfs2fudsh0wzusccaqve8kqcpxygwcy2yevvc7czq4sky7x35ev5xwxlwja96rh5sdwwaq6alnkgva04087jmyzsjkk5pze4z6lvlv0y6r5zcvcsuqqxhl25xdc8436p9ckw5gzqt7m3xn7erpurszm5d92k8r7e87yhycg6mylacaxvtlqactz7nutc0tg83rneqgsjdjg20te59yufpw5j40wmnxvvkjggm2mw0up5du0e92fmra7gk8x8jxgguu7yzwkpjphkzduwzcskz92r8l5f4cm7a4yrj5gnpepde42equvxua3hahxfh8dsvcs3ls2w94g0f8npgv488lawf8dcpgcapxc8plsczcn9ketuywwxaecy0syqfp0926dppnx34tacyu2hytfuayjc0dq3r8tuqw3zxx9q05qs5yqdgtdmngcfx5xx3lm5vwyw2wnykak3ga76wckcs5k3ucxged24axkdgyx4haujkrvnp4hakcp35xkf37vygd7mlnu8pcg9upx96xhzfjdlfdtf90l8khs50h409pwt934sx5ckk7ewllcn0daqmxx55jzcm3rnvq26l9shycupgty0vtuzectnh5k2cqe454fgwkw0tyg67cnp3wwfx0sqlrnnzfpd2j0qge97uzys9q0anh73984xlpyy0vshl2kg8q4penm7dwjdm5kc6tkqh9zfx9prn2f2ua5a4a9xs0hw9ct24zc9adlscuedjcgx2jrju3z4p7mlkd9umrew6g4mscqxhvu92ntnc64suur3209ry6sm04xz6va2l8gxwxv2px9n8yuz20q8dhnty9g4g7en8adkxsa7ks8mcptsff23c9nf4922auem3586t885gp5aa3aanhjcych8pfp00slq3scfcd9pc227qljl6f2kxnefyl0v2mh9z8qu8hf927kfzntueydj8ussyeyy893ekfv3785qavdgtq7afvt3vv45vywfhs48jmxm2jxat88z670fuc9th0gd4gak5ws6vdhcump5x2n2vqcz9z8zyd7u35tc0vp7fq2kevpd7d6x7694ase5lm9p8hewuzvwfradg9xggevyvv843fn84fx0vrh9trpv6xjkv4g20gkt892tly2a0dzr8z9auvcmv9zvf3krrzmfchvd8rgsr5v9s0cgm5hyg2vvdyd48se2yt7sffdykcw4uvmm5e6cc4t7lzef8fhcq7x2mprnhkztduga6gvla6j8yv083e2m7l970mhcd6aplyfwy5g02e5gz0zcp6vud4ssk94et3rh55m8sh9gphdgvxzv29xxuhd8dr3j8lkjwfpx0wcjretayu9s78jeug2grj2xn5nk6y3w4dzxfh94kfy0wkhmu4sy3cd727dzyn75ayw7m646akl3y6z2w90nlzrvzuhyzsszhm2thazf20gvzwc45xh783pzzyrc6v8547eg0ch5lx3w95m9kwtpa70y5nue4l5ulg874ret59h97ry076qluyzzz629xecxw6dn2c6gjma3yrwphzaztkuxhxjr6y8ytfsv6364eszdguzujj62qpjjp26sn3sxly7jvx4t27gv8z0sxu2y2nqxggfca6ccuagh753qxnlrtmuvx9hk0n6nvdgzk7j5y4pta6fphszqrzpeln3r3ra0krp7un53pmgrys09dr9nua53s5dvttfetgl05petyl3hmcgsj2s64afv7sf9lcfx7gqhf45qt0p9h49aentq320yr6llp2ft6upsae0qht3fhnk94vtv6v0lskd0jsfd9dyer7um5gclgj52wckaeucl3d80ew83kec3rsk3sfg53rk4qdwlst0xp0eawn8kavx5ccvawc6e5nxw9hn3kuyufnljymg6gpq9e6ym6n90w6acgrzu3cscw87wkys88wur5jhfe3fkwnvyfmvnjalpm05u2ttvzzkdycsdy27yjw4gm888089xhy8elsfqqzxrxl4rl49gyxlgczedwye83dyc8t5tqvfjqrw5zhxfm9888ztx3nkm7egqg59tea06dzedd9h2avk0600pwtznjrrxmy9rvj3epgp72c02wka4vempnsm0kq67aytvfyw3kfwhw5czzj7te5udazfjnnvujs5c9053rn66ufkq2gs5s7su3tcvp6vzj70vfze0x9jp9hrev2t7h58qavenzt3nsn575fzzdgz9lwk43m3p7rcwmsnkmmu93up5dyha2wvqmy0s23xj8k6n9nun0q2clw86msz57zkwdcnqz87qf76akdd3km9j5agpaxuaw8gn6ld4kd0k4yc5mpytuc4x7kcy02lt9h0ykxcukxmvkrwwmer9a47cc77wuyw5gfhp4hupey5q5mwt5szfdq35kksshhhllelkw7h05vknx0tzgd5ngdp9qzwm3az8gjznj4c8nrsepr23u0qtkz7nw6ch0qnktw7w9wld0zdh5gq99tzymag83767953jm3ywzczetkfh0z9q4hd5ae8gz42dd60emdgwzakrket38a0mh2jxyadgksgsz5sf7pqd"

# Check if miner and bridge exist
if [ ! -f "./miner_21g" ]; then
    echo "‚ùå Error: ./miner_21g not found. Please compile first."
    exit 1
fi

if [ ! -f "./miner-bridge" ]; then
    echo "‚ùå Error: ./miner-bridge not found. Please compile first."
    exit 1
fi

# Function to cleanup on exit
cleanup() {
    echo ""
    echo "üõë Stopping all miners and bridge..."
    pkill -f "./miner_21g --gpu" 2>/dev/null
    pkill -f "./miner-bridge" 2>/dev/null
    wait
    echo "‚úÖ All miners and bridge stopped"
    exit 0
}

# Set up signal handling
trap cleanup SIGINT SIGTERM

# Start miner-bridge first
echo "üîó Starting miner-bridge..."
./miner-bridge --guesser-address nolgam1gg95kxhexzl607kvqf9qfltuhh67r45jw840pu3mc9ntprgpq7v4e5k76l26pg6vhwdkpkak52rvvus4xez4gt0dd96wr52y8cgcntyanadxe9uj0p0vmg47v47xfe9c6ryu37suc3wzlwhye5kzy7nk9x3ppx50038k750z75hvhak8zj9p73p9tq4autdzqr3dxmq4udqwvjcn4af0aecfxclrwf8wk89z777aknhjhfk50g4g0jjrx4u44drek3c2qa2mmxx6js4uses2ldfaztrttu42p02wrluuxvt4ls9k44uxqzhxadetdrzaahy2v5ntcjwqjfujmn6vc6mcxdtd0eqppwjqm4h4m72frrf6z79gmf8g6h47zlc7k44se09v6dxqcg6hygndlyzyldn77q0ysam7wz6summmkdpjftx0tmvptn9kvst5j0rhzv33ayu7q25zgf82xh743r94jr7dc0qgqrrzg0hr23mtm2hqp80uaqzwnm4gsf4vfsylzuc79d7u2rmzew27e5z9mwl3ej95hj79gm264p5zmcwnk4vw370crxrpacfaaxf9mukhpx0w3lyyswh483zhn90kycc9cky4zafdtxev5aprjf64md6uus7spxxfm20qpvmzjp8g376yrn0rm9l8u337fj7xx3wuwqexfqyttrzydnqsfex3yjurh5wy5jc0dsqen58s6lr704tgujyjk0afmeqt2sst3s0rkwrnqgrv2q5k88gl40dznuj6a02ynlpwed8e4fcdr2dshv2fa7kv4a8laqvg0tqlvunhqkwst7sgmujxtaw73ejjczwl9ucs767rh4xcaujqw2a798my8ngfk6m6v0dsfs2fudsh0wzusccaqve8kqcpxygwcy2yevvc7czq4sky7x35ev5xwxlwja96rh5sdwwaq6alnkgva04087jmyzsjkk5pze4z6lvlv0y6r5zcvcsuqqxhl25xdc8436p9ckw5gzqt7m3xn7erpurszm5d92k8r7e87yhycg6mylacaxvtlqactz7nutc0tg83rneqgsjdjg20te59yufpw5j40wmnxvvkjggm2mw0up5du0e92fmra7gk8x8jxgguu7yzwkpjphkzduwzcskz92r8l5f4cm7a4yrj5gnpepde42equvxua3hahxfh8dsvcs3ls2w94g0f8npgv488lawf8dcpgcapxc8plsczcn9ketuywwxaecy0syqfp0926dppnx34tacyu2hytfuayjc0dq3r8tuqw3zxx9q05qs5yqdgtdmngcfx5xx3lm5vwyw2wnykak3ga76wckcs5k3ucxged24axkdgyx4haujkrvnp4hakcp35xkf37vygd7mlnu8pcg9upx96xhzfjdlfdtf90l8khs50h409pwt934sx5ckk7ewllcn0daqmxx55jzcm3rnvq26l9shycupgty0vtuzectnh5k2cqe454fgwkw0tyg67cnp3wwfx0sqlrnnzfpd2j0qge97uzys9q0anh73984xlpyy0vshl2kg8q4penm7dwjdm5kc6tkqh9zfx9prn2f2ua5a4a9xs0hw9ct24zc9adlscuedjcgx2jrju3z4p7mlkd9umrew6g4mscqxhvu92ntnc64suur3209ry6sm04xz6va2l8gxwxv2px9n8yuz20q8dhnty9g4g7en8adkxsa7ks8mcptsff23c9nf4922auem3586t885gp5aa3aanhjcych8pfp00slq3scfcd9pc227qljl6f2kxnefyl0v2mh9z8qu8hf927kfzntueydj8ussyeyy893ekfv3785qavdgtq7afvt3vv45vywfhs48jmxm2jxat88z670fuc9th0gd4gak5ws6vdhcump5x2n2vqcz9z8zyd7u35tc0vp7fq2kevpd7d6x7694ase5lm9p8hewuzvwfradg9xggevyvv843fn84fx0vrh9trpv6xjkv4g20gkt892tly2a0dzr8z9auvcmv9zvf3krrzmfchvd8rgsr5v9s0cgm5hyg2vvdyd48se2yt7sffdykcw4uvmm5e6cc4t7lzef8fhcq7x2mprnhkztduga6gvla6j8yv083e2m7l970mhcd6aplyfwy5g02e5gz0zcp6vud4ssk94et3rh55m8sh9gphdgvxzv29xxuhd8dr3j8lkjwfpx0wcjretayu9s78jeug2grj2xn5nk6y3w4dzxfh94kfy0wkhmu4sy3cd727dzyn75ayw7m646akl3y6z2w90nlzrvzuhyzsszhm2thazf20gvzwc45xh783pzzyrc6v8547eg0ch5lx3w95m9kwtpa70y5nue4l5ulg874ret59h97ry076qluyzzz629xecxw6dn2c6gjma3yrwphzaztkuxhxjr6y8ytfsv6364eszdguzujj62qpjjp26sn3sxly7jvx4t27gv8z0sxu2y2nqxggfca6ccuagh753qxnlrtmuvx9hk0n6nvdgzk7j5y4pta6fphszqrzpeln3r3ra0krp7un53pmgrys09dr9nua53s5dvttfetgl05petyl3hmcgsj2s64afv7sf9lcfx7gqhf45qt0p9h49aentq320yr6llp2ft6upsae0qht3fhnk94vtv6v0lskd0jsfd9dyer7um5gclgj52wckaeucl3d80ew83kec3rsk3sfg53rk4qdwlst0xp0eawn8kavx5ccvawc6e5nxw9hn3kuyufnljymg6gpq9e6ym6n90w6acgrzu3cscw87wkys88wur5jhfe3fkwnvyfmvnjalpm05u2ttvzzkdycsdy27yjw4gm888089xhy8elsfqqzxrxl4rl49gyxlgczedwye83dyc8t5tqvfjqrw5zhxfm9888ztx3nkm7egqg59tea06dzedd9h2avk0600pwtznjrrxmy9rvj3epgp72c02wka4vempnsm0kq67aytvfyw3kfwhw5czzj7te5udazfjnnvujs5c9053rn66ufkq2gs5s7su3tcvp6vzj70vfze0x9jp9hrev2t7h58qavenzt3nsn575fzzdgz9lwk43m3p7rcwmsnkmmu93up5dyha2wvqmy0s23xj8k6n9nun0q2clw86msz57zkwdcnqz87qf76akdd3km9j5agpaxuaw8gn6ld4kd0k4yc5mpytuc4x7kcy02lt9h0ykxcukxmvkrwwmer9a47cc77wuyw5gfhp4hupey5q5mwt5szfdq35kksshhhllelkw7h05vknx0tzgd5ngdp9qzwm3az8gjznj4c8nrsepr23u0qtkz7nw6ch0qnktw7w9wld0zdh5gq99tzymag83767953jm3ywzczetkfh0z9q4hd5ae8gz42dd60emdgwzakrket38a0mh2jxyadgksgsz5sf7pqd &
sleep 2  # Give bridge time to start

# Start miners on available GPUs
for gpu_id in {0..1}; do
    # Check if GPU exists
    if nvidia-smi -i $gpu_id &>/dev/null; then
        nonce_offset=$((147000 + gpu_id * 150))
        echo "üöÄ Starting miner on GPU $gpu_id with nonce offset $nonce_offset"
        
        # Start miner (no wallet address needed - handled by bridge)
        ./miner_21g --gpu $gpu_id --nonce-offset $nonce_offset &
        
        sleep 1  # Small delay between starts
    else
        echo "‚ö†Ô∏è  GPU $gpu_id not available, skipping"
    fi
done

echo ""
echo "‚úÖ All available miners and bridge started"
echo "üí° Each GPU uses a different nonce offset:"
echo "   GPU 0: nonce offset $((147000 + 0 * 150))"
echo "   GPU 1: nonce offset $((147000 + 1 * 150))"
echo "üîó Miner-bridge handling wallet: nolgam1gg95kxhexzl607kvqf9qfltuhh67r45jw840pu3mc9ntprgpq7v4e5k76l26pg6vhwdkpkak52rvvus4xez4gt0dd96wr52y8cgcntyanadxe9uj0p0vmg47v47xfe9c6ryu37suc3wzlwhye5kzy7nk9x3ppx50038k750z75hvhak8zj9p73p9tq4autdzqr3dxmq4udqwvjcn4af0aecfxclrwf8wk89z777aknhjhfk50g4g0jjrx4u44drek3c2qa2mmxx6js4uses2ldfaztrttu42p02wrluuxvt4ls9k44uxqzhxadetdrzaahy2v5ntcjwqjfujmn6vc6mcxdtd0eqppwjqm4h4m72frrf6z79gmf8g6h47zlc7k44se09v6dxqcg6hygndlyzyldn77q0ysam7wz6summmkdpjftx0tmvptn9kvst5j0rhzv33ayu7q25zgf82xh743r94jr7dc0qgqrrzg0hr23mtm2hqp80uaqzwnm4gsf4vfsylzuc79d7u2rmzew27e5z9mwl3ej95hj79gm264p5zmcwnk4vw370crxrpacfaaxf9mukhpx0w3lyyswh483zhn90kycc9cky4zafdtxev5aprjf64md6uus7spxxfm20qpvmzjp8g376yrn0rm9l8u337fj7xx3wuwqexfqyttrzydnqsfex3yjurh5wy5jc0dsqen58s6lr704tgujyjk0afmeqt2sst3s0rkwrnqgrv2q5k88gl40dznuj6a02ynlpwed8e4fcdr2dshv2fa7kv4a8laqvg0tqlvunhqkwst7sgmujxtaw73ejjczwl9ucs767rh4xcaujqw2a798my8ngfk6m6v0dsfs2fudsh0wzusccaqve8kqcpxygwcy2yevvc7czq4sky7x35ev5xwxlwja96rh5sdwwaq6alnkgva04087jmyzsjkk5pze4z6lvlv0y6r5zcvcsuqqxhl25xdc8436p9ckw5gzqt7m3xn7erpurszm5d92k8r7e87yhycg6mylacaxvtlqactz7nutc0tg83rneqgsjdjg20te59yufpw5j40wmnxvvkjggm2mw0up5du0e92fmra7gk8x8jxgguu7yzwkpjphkzduwzcskz92r8l5f4cm7a4yrj5gnpepde42equvxua3hahxfh8dsvcs3ls2w94g0f8npgv488lawf8dcpgcapxc8plsczcn9ketuywwxaecy0syqfp0926dppnx34tacyu2hytfuayjc0dq3r8tuqw3zxx9q05qs5yqdgtdmngcfx5xx3lm5vwyw2wnykak3ga76wckcs5k3ucxged24axkdgyx4haujkrvnp4hakcp35xkf37vygd7mlnu8pcg9upx96xhzfjdlfdtf90l8khs50h409pwt934sx5ckk7ewllcn0daqmxx55jzcm3rnvq26l9shycupgty0vtuzectnh5k2cqe454fgwkw0tyg67cnp3wwfx0sqlrnnzfpd2j0qge97uzys9q0anh73984xlpyy0vshl2kg8q4penm7dwjdm5kc6tkqh9zfx9prn2f2ua5a4a9xs0hw9ct24zc9adlscuedjcgx2jrju3z4p7mlkd9umrew6g4mscqxhvu92ntnc64suur3209ry6sm04xz6va2l8gxwxv2px9n8yuz20q8dhnty9g4g7en8adkxsa7ks8mcptsff23c9nf4922auem3586t885gp5aa3aanhjcych8pfp00slq3scfcd9pc227qljl6f2kxnefyl0v2mh9z8qu8hf927kfzntueydj8ussyeyy893ekfv3785qavdgtq7afvt3vv45vywfhs48jmxm2jxat88z670fuc9th0gd4gak5ws6vdhcump5x2n2vqcz9z8zyd7u35tc0vp7fq2kevpd7d6x7694ase5lm9p8hewuzvwfradg9xggevyvv843fn84fx0vrh9trpv6xjkv4g20gkt892tly2a0dzr8z9auvcmv9zvf3krrzmfchvd8rgsr5v9s0cgm5hyg2vvdyd48se2yt7sffdykcw4uvmm5e6cc4t7lzef8fhcq7x2mprnhkztduga6gvla6j8yv083e2m7l970mhcd6aplyfwy5g02e5gz0zcp6vud4ssk94et3rh55m8sh9gphdgvxzv29xxuhd8dr3j8lkjwfpx0wcjretayu9s78jeug2grj2xn5nk6y3w4dzxfh94kfy0wkhmu4sy3cd727dzyn75ayw7m646akl3y6z2w90nlzrvzuhyzsszhm2thazf20gvzwc45xh783pzzyrc6v8547eg0ch5lx3w95m9kwtpa70y5nue4l5ulg874ret59h97ry076qluyzzz629xecxw6dn2c6gjma3yrwphzaztkuxhxjr6y8ytfsv6364eszdguzujj62qpjjp26sn3sxly7jvx4t27gv8z0sxu2y2nqxggfca6ccuagh753qxnlrtmuvx9hk0n6nvdgzk7j5y4pta6fphszqrzpeln3r3ra0krp7un53pmgrys09dr9nua53s5dvttfetgl05petyl3hmcgsj2s64afv7sf9lcfx7gqhf45qt0p9h49aentq320yr6llp2ft6upsae0qht3fhnk94vtv6v0lskd0jsfd9dyer7um5gclgj52wckaeucl3d80ew83kec3rsk3sfg53rk4qdwlst0xp0eawn8kavx5ccvawc6e5nxw9hn3kuyufnljymg6gpq9e6ym6n90w6acgrzu3cscw87wkys88wur5jhfe3fkwnvyfmvnjalpm05u2ttvzzkdycsdy27yjw4gm888089xhy8elsfqqzxrxl4rl49gyxlgczedwye83dyc8t5tqvfjqrw5zhxfm9888ztx3nkm7egqg59tea06dzedd9h2avk0600pwtznjrrxmy9rvj3epgp72c02wka4vempnsm0kq67aytvfyw3kfwhw5czzj7te5udazfjnnvujs5c9053rn66ufkq2gs5s7su3tcvp6vzj70vfze0x9jp9hrev2t7h58qavenzt3nsn575fzzdgz9lwk43m3p7rcwmsnkmmu93up5dyha2wvqmy0s23xj8k6n9nun0q2clw86msz57zkwdcnqz87qf76akdd3km9j5agpaxuaw8gn6ld4kd0k4yc5mpytuc4x7kcy02lt9h0ykxcukxmvkrwwmer9a47cc77wuyw5gfhp4hupey5q5mwt5szfdq35kksshhhllelkw7h05vknx0tzgd5ngdp9qzwm3az8gjznj4c8nrsepr23u0qtkz7nw6ch0qnktw7w9wld0zdh5gq99tzymag83767953jm3ywzczetkfh0z9q4hd5ae8gz42dd60emdgwzakrket38a0mh2jxyadgksgsz5sf7pqd"
echo ""
echo "Press Ctrl+C to stop all miners and bridge"

# Wait for all background processes
wait